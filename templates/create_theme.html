<!DOCTYPE html>
<html>
{% extends "base.html" %}
{% load static %}
{% block content %}

<body>
    <div class="container text-center">
        <h1 style="font-size: 70px;">Create Theme</h1>
    </div>
    <div class="container-fluid text-center">
        <form method="post" action="{% url 'create_theme' %}" class="mt-4" id="theme-form">
            {% csrf_token %}
            <div class="card-body">
                {{ form.non_form_errors }}


                <input type="text" name="title" placeholder="Theme Title" required>
                <textarea name="description" placeholder="Theme Description" required></textarea>

                <h2>Tasks</h2>
                <div id="task-container">
                    <div class="task-inputs">
                        <input type="text" class="task-name" placeholder="Task Name" required>
                        <textarea class="task-task" placeholder="Task" required></textarea>
                        <textarea class="task-hint" placeholder="Task Hint" required></textarea>
                        <input type="number" class="task-latitude" placeholder="Latitude" required>
                        <input type="number" class="task-longitude" placeholder="Longitude" required>
                    </div>
                </div>
                <button type="button" id="add-task" class="btn btn-info">Add Task</button>
                <button type="button" id="delete-task" class="btn btn-warning">Delete Last Task</button>

                <input type="hidden" name="tasks_json" id="tasks-json">

                <button type="submit" class="btn btn-primary">Create Theme</button>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('add-task').addEventListener('click', function() {
            let taskContainer = document.getElementById('task-container');
            let newTaskDiv = document.createElement('div');
            newTaskDiv.className = 'task-inputs';
            newTaskDiv.innerHTML = `
                <input type="text" class="task-name" placeholder="Task Name" required>
                <textarea class="task-task" placeholder="Task" required></textarea>
                <textarea class="task-hint" placeholder="Task Hint" required></textarea>
                <input type="number" class="task-latitude" placeholder="Latitude" required>
                <input type="number" class="task-longitude" placeholder="Longitude" required>
            `;
            taskContainer.appendChild(newTaskDiv);
        });

        document.getElementById('delete-task').addEventListener('click', function() {
            let taskContainer = document.getElementById('task-container');
            if (taskContainer.children.length > 1) {
                taskContainer.removeChild(taskContainer.lastChild);
            } else {
                alert('At least one task must remain.');
            }
        });

        document.getElementById('theme-form').addEventListener('submit', function(event) {
            let tasks = [];
            document.querySelectorAll('.task-inputs').forEach(taskDiv => {
                let task = {
                    name: taskDiv.querySelector('.task-name').value,
                    task: taskDiv.querySelector('.task-task').value,
                    hint: taskDiv.querySelector('.task-hint').value,
                    latitude: parseFloat(taskDiv.querySelector('.task-latitude').value),
                    longitude: parseFloat(taskDiv.querySelector('.task-longitude').value)
                };
                tasks.push(task);
            });
            document.getElementById('tasks-json').value = JSON.stringify(tasks);
        });
    </script>
</body>
{% endblock %}
</html>
