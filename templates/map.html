{% extends "base.html" %}
{% load static %}
{% block content %}
<!-- 
Title: Django Google Maps Tutorial #4: Placing Markers on a Map
URL: https://www.youtube.com/watch?v=sasx2ppol5c&t=685s -->
<!DOCTYPE html>
<style>
.mapholder{
    height: 500px;
    width: 100%;
}

#map{
    height: 100%;
}
</style>

<script src="https://maps.googleapis.com/maps/api/js?key={{key}}&libraries=places"></script>

<!-- Title: How To Find the Route Between Two Markers using Google Maps API (ChatGPT Query)
Link: https://chat.openai.com/share/f2f2591e-18bc-4ebf-b6d6-db23ce038802 -->
    <script>
        var map;
        var marker1;
        var marker2;
        async function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center:{lat: 38.0336, lng: -78.5080}, 
                zoom: 15,
            });

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                    };
                    () => {
                        handleLocationError(true, infoWindow, map.getCenter());
                },

                    marker1 = new google.maps.Marker({
                        position: userLocation, 
                        map: map,
                        title: 'Your Location'
                    });
                    marker1.setVisible(false);
            },
            function error(msg) {alert('Please enable your GPS position feature.');},
            {maximumAge:0, timeout:5000, enableHighAccuracy: true});;
            } else {
            alert('Geolocation is not supported by your browser.');
            }

            marker2 = new google.maps.Marker({
                position: { lat: {{latitude}}, lng: {{longitude}} }, 
                map: map,
                title: 'Hint Location'
            });
            marker2.setVisible(false);

        }

        function calculateAndDisplayRoute(directionsService, directionsDisplay) {
                directionsService.route({
                    origin: marker1.getPosition(),
                    destination: marker2.getPosition(),
                    travelMode: 'WALKING',

                }, function(response, status) {
                    if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    } else {
                    window.alert('Directions request failed due to ' + status);
                    }
                });
            }

        function calculateDirections() {
            var directionsService = new google.maps.DirectionsService();
            var directionsDisplay = new google.maps.DirectionsRenderer();
            directionsDisplay.setMap(map);
            calculateAndDisplayRoute(directionsService, directionsDisplay);
        }
    </script>
<html>
<div class = "pageholder">
<h1>Hint: "{{hint}}"</h1> <br>
<!-- <p>Hover over the pin to see the hint!<p> -->
<!-- <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script> -->

<div class = "linkholder">
    <div class="mapholder">
        <div id="map"> </div> <br>
            <script async
                src="https://maps.googleapis.com/maps/api/js?key={{key}}&callback=initMap">
            </script>
        <button onclick="calculateDirections()" class="btn btn-primary">Find Route To Hint</button>
      
</div>
</div>
</html>

{% endblock %}